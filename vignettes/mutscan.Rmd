---
title: "mutscan"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{mutscan}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(mutscan)
```

## Read example data

```{r readTrans}
datadir <- system.file("extdata", package = "mutscan")
dir(datadir)
transInput <- readFastqsTrans(fastqForward = file.path(datadir, "transInput_1.fastq.gz"),
                              fastqReverse = file.path(datadir, "transInput_2.fastq.gz"),
                              skipForward = 1, skipReverse = 1, umiLengthForward = 10, 
                              umiLengthReverse = 8, constantLengthForward = 18,
                              constantLengthReverse = 20, adapterForward = "GGAAGAGCACACGTC", 
                              adapterReverse = "GGAAGAGCGTCGTGT", verbose = TRUE)
transInput$readSummary
```

## Filter reads

```{r filterTrans}
transInputFiltered <- filterTrans(transInput, avePhredMin = 20, 
                                  variableNMax = 0, umiNMax = 0, 
                                  wildTypeForward = "ACTGATACACTCCAAGCGGAGACAGACCAACTAGAAGATGAGAAGTCTGCTTTGCAGACCGAGATTGCCAACCTGCTGAAGGAGAAGGAAAAACTA",
                                  wildTypeReverse = "ATCGCCCGGCTGGAGGAAAAAGTGAAAACCTTGAAAGCTCAGAACTCGGAGCTGGCGTCCACGGCCAACATGCTCAGGGAACAGGTGGCACAGCTT", 
                                  nbrMutatedCodonsMax = 1, forbiddenMutatedCodon = "NNW")
transInputFiltered$readSummary
```

## Estimate sequencing error rate from constant sequences

```{r errStats}
# user-provided expected sequences
# errStats <- calcErrorStats(transInputFiltered, expectedForward = "AACCGGAGGAGGGAGCTG", 
#                            expectedReverse = "GAAAAAGGAAGCTGGAGAGA", verbose = TRUE)

# auto-detect expected sequences
errStats <- calcErrorStats(transInputFiltered, verbose = TRUE)
errStats$propErrorsConstantF
errStats$propErrorsConstantR
```

## Count occurrences of each combination of variants 

```{r count}
count <- as.data.frame(table(paste(transInputFiltered$variableSeqForward, 
                                   transInputFiltered$variableSeqReverse, 
                                   sep = "__")))
```

